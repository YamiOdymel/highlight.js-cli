#!/usr/bin/env node

var cli = require('cli'),
	hljs = require('highlight.js'),
	cheerio = require('cheerio'),
	Entities = require('html-entities').AllHtmlEntities,
	entities = new Entities(),
	opts = cli.parse();
	
var options = {
    selector: 'pre code'
};

if (opts.s) {
	options.selector = opts.s;
}
	
cli.withStdin(function(input) {
	var $ = cheerio.load(input);
	$(options.selector).each(function(i, elem) {
		var lang = $(this).attr('class');
		$(this).text(lang ? hljs.highlight(lang, $(this).text()).value : hljs.highlightAuto($(this).text()).value).addClass('hljs');
	});
	this.output(entities.decode($.html()));
});