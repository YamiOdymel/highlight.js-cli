#!/usr/bin/env node

var cli = require('cli'),
	hljs = require('highlight.js'),
	cheerio = require('cheerio'),
	Entities = require('html-entities').AllHtmlEntities,
	entities = new Entities(),
	opts = cli.parse();
	
var options = {
    selector: 'pre code'
};

if (opts.s) {
	options.selector = opts.s;
}
	
cli.withStdin(function(input) {
	var $ = cheerio.load(input);
	var a;
	$(options.selector).each(function(i, elem) {
	
		$(this).html(hljs.highlightAuto($(this).text()).value);
		a = $(this).text();
	});
	this.output(entities.decode($.html()));
});